name: AI Issue Helper

on:
  issue_comment:
    types: [created]

permissions:
  issues: write
  contents: read

jobs:
  ai-helper:
    runs-on: ubuntu-latest
    # åªåœ¨ç”¨æˆ·æåˆ° @ai-helper æ—¶è§¦å‘
    if: contains(github.event.comment.body, '@ai-helper')
    steps:
      - name: Get Issue Details
        id: issue
        uses: actions/github-script@v7
        with:
          script: |
            const issue = await github.rest.issues.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number
            });
            return {
              title: issue.data.title,
              body: issue.data.body,
              number: issue.data.number
            };

      - name: AI Analysis
        uses: actions/ai-inference@v1
        id: ai
        with:
          model: 'gpt-4o-mini'
          system-prompt: |
            ä½ æ˜¯ ECS Framework é¡¹ç›®çš„ AI åŠ©æ‰‹ã€‚
            é¡¹ç›®ä¿¡æ¯ï¼š
            - è¿™æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ TypeScript ECS (Entity-Component-System) æ¡†æ¶
            - æ”¯æŒ Cocos Creatorã€Laya å¼•æ“å’Œ Web å¹³å°
            - æ–‡æ¡£åœ°å€ï¼šhttps://esengine.github.io/ecs-framework/
            - AI æ–‡æ¡£ï¼šhttps://deepwiki.com/esengine/ecs-framework

            è¯·ç”¨ä¸­æ–‡å‹å¥½åœ°å›å¤ç”¨æˆ·çš„é—®é¢˜ã€‚
          prompt: |
            ç”¨æˆ·åœ¨ Issue #${{ github.event.issue.number }} ä¸­è¯·æ±‚å¸®åŠ©ã€‚

            Issue æ ‡é¢˜ï¼š${{ steps.issue.outputs.result.title }}

            Issue å†…å®¹ï¼š
            ${{ steps.issue.outputs.result.body }}

            ç”¨æˆ·è¯„è®ºï¼š
            ${{ github.event.comment.body }}

            è¯·åˆ†æç”¨æˆ·çš„é—®é¢˜å¹¶æä¾›å¸®åŠ©ï¼š
            1. é—®é¢˜åˆ†æ
            2. å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ
            3. ç›¸å…³æ–‡æ¡£é“¾æ¥
            4. éœ€è¦è¡¥å……çš„ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

            ç”¨ä»¥ä¸‹æ ¼å¼å›å¤ï¼š

            ğŸ‘‹ ä½ å¥½ï¼æˆ‘æ˜¯ AI åŠ©æ‰‹ï¼Œè®©æˆ‘å¸®ä½ åˆ†æè¿™ä¸ªé—®é¢˜ã€‚

            **é—®é¢˜åˆ†æ**
            [åˆ†æå†…å®¹]

            **å»ºè®®æ–¹æ¡ˆ**
            [è§£å†³æ–¹æ¡ˆ]

            **ç›¸å…³èµ„æº**
            - ğŸ“š [æ–‡æ¡£é“¾æ¥]
            - ğŸ’¡ [ç¤ºä¾‹é“¾æ¥]

            å¦‚æœæˆ‘çš„å»ºè®®æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œè¯·æä¾›æ›´å¤šä¿¡æ¯ï¼Œç»´æŠ¤è€…ä¼šå°½å¿«å›å¤ï¼

      - name: Post AI Response
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: `${{ steps.ai.outputs.response }}`
            });
