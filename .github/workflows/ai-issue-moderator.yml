name: AI Issue Moderator

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]

permissions:
  issues: write
  contents: read

jobs:
  moderate:
    runs-on: ubuntu-latest
    steps:
      - name: Check Content
        uses: actions/ai-inference@v1
        id: check
        with:
          model: 'gpt-4o-mini'
          system-prompt: |
            ä½ æ˜¯ä¸€ä¸ªå†…å®¹å®¡æŸ¥åŠ©æ‰‹ã€‚
            æ£€æŸ¥å†…å®¹æ˜¯å¦åŒ…å«ï¼š
            1. åƒåœ¾ä¿¡æ¯æˆ–å¹¿å‘Š
            2. æ¶æ„æˆ–æ”»å‡»æ€§å†…å®¹
            3. ä¸é¡¹ç›®å®Œå…¨æ— å…³çš„å†…å®¹

            åªè¿”å› "SPAM" æˆ– "OK"ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
          prompt: |
            æ ‡é¢˜ï¼š${{ github.event.issue.title || github.event.comment.body }}

            å†…å®¹ï¼š
            ${{ github.event.issue.body || github.event.comment.body }}

      - name: Mark as Spam
        if: contains(steps.check.outputs.response, 'SPAM')
        uses: actions/github-script@v7
        with:
          script: |
            // æ·»åŠ  spam æ ‡ç­¾
            github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              labels: ['spam']
            });

            // æ·»åŠ è¯„è®º
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: 'ğŸ¤– è¿™ä¸ªå†…å®¹è¢« AI æ£€æµ‹ä¸ºå¯èƒ½çš„åƒåœ¾å†…å®¹ã€‚å¦‚æœè¿™æ˜¯è¯¯åˆ¤ï¼Œè¯·è”ç³»ç»´æŠ¤è€…ã€‚\n\nğŸ¤– This content was detected as potential spam by AI. If this is a false positive, please contact the maintainers.'
            });
