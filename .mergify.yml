queue_rules:
  - name: default
    conditions:
      - check-success=CI
      - check-success=Commit Lint

  # å¼€å‘ä¾èµ–é˜Ÿåˆ— - åªéœ€è¦ Commit Lint é€šè¿‡
  - name: dev-dependencies
    conditions:
      - check-success=Commit Lint

pull_request_rules:
  # è‡ªåŠ¨åˆå¹¶ Dependabot å¼€å‘ä¾èµ–åˆ†ç»„æ›´æ–°ï¼ˆé£é™©ä½ï¼Œå…è®¸ CI å¤±è´¥ï¼‰
  - name: è‡ªåŠ¨åˆå¹¶ Dependabot å¼€å‘ä¾èµ–
    conditions:
      - author=dependabot[bot]
      - or:
        - title~=(?i)dev.dependencies
        - label=dependencies
        - body~=(?i)development.dependencies
      - check-success=Commit Lint
      # æ’é™¤ä¸»è¦ç‰ˆæœ¬æ›´æ–°
      - -title~=(?i)major
    actions:
      review:
        type: APPROVE
        message: |
          ğŸ¤– è‡ªåŠ¨æ‰¹å‡†å¼€å‘ä¾èµ–æ›´æ–°

          å¼€å‘ä¾èµ–æ›´æ–°é£é™©è¾ƒä½ï¼Œå³ä½¿æµ‹è¯•å¤±è´¥ä¹Ÿä¸å½±å“ç”Ÿäº§ç¯å¢ƒã€‚
          å¦‚æœ‰é—®é¢˜ä¼šåœ¨åç»­å¼€å‘ä¸­å‘ç°å¹¶ä¿®å¤ã€‚
      queue:
        name: dev-dependencies
      label:
        add:
          - auto-merged

  # è‡ªåŠ¨åˆå¹¶ Dependabot ç”Ÿäº§ä¾èµ–çš„ patch æ›´æ–°ï¼ˆå¿…é¡» CI é€šè¿‡ï¼‰
  - name: è‡ªåŠ¨åˆå¹¶ Dependabot ç”Ÿäº§ä¾èµ– patch æ›´æ–°
    conditions:
      - author=dependabot[bot]
      - or:
        - title~=(?i)production.dependencies
        - and:
          - label=dependencies
          - -body~=(?i)development.dependencies
      - title~=(?i)patch
      - check-success=CI
      - check-success=Commit Lint
    actions:
      review:
        type: APPROVE
        message: ğŸ¤– è‡ªåŠ¨æ‰¹å‡†ç”Ÿäº§ä¾èµ– patch æ›´æ–°ï¼ˆæµ‹è¯•é€šè¿‡ï¼‰
      queue:
        name: default
      label:
        add:
          - auto-merged

  # è‡ªåŠ¨åˆå¹¶ GitHub Actions æ›´æ–°ï¼ˆé£é™©ä½ï¼‰
  - name: è‡ªåŠ¨åˆå¹¶ GitHub Actions æ›´æ–°
    conditions:
      - author=dependabot[bot]
      - label=github-actions
      - check-success=Commit Lint
    actions:
      review:
        type: APPROVE
        message: ğŸ¤– è‡ªåŠ¨æ‰¹å‡† GitHub Actions æ›´æ–°
      queue:
        name: dev-dependencies
      label:
        add:
          - auto-merged

  # æ ‡è®°éœ€è¦äººå·¥å®¡æ ¸çš„é‡è¦æ›´æ–°
  - name: æ ‡è®°éœ€è¦äººå·¥å®¡æ ¸çš„ç”Ÿäº§ä¾èµ–æ›´æ–°
    conditions:
      - author=dependabot[bot]
      - or:
        - title~=(?i)production.dependencies
        - and:
          - label=dependencies
          - -body~=(?i)development.dependencies
      - or:
        - title~=(?i)minor
        - title~=(?i)major
        - -check-success=CI
    actions:
      label:
        add:
          - needs-manual-review
      comment:
        message: |
          âš ï¸ **éœ€è¦äººå·¥å®¡æ ¸**

          æ­¤æ›´æ–°å±äºä»¥ä¸‹æƒ…å†µä¹‹ä¸€ï¼Œå»ºè®®äººå·¥å®¡æ ¸ï¼š
          - ç”Ÿäº§ä¾èµ–çš„ minor/major ç‰ˆæœ¬æ›´æ–°
          - CI æµ‹è¯•æœªé€šè¿‡

          Please review this update manually.

  # è‡ªåŠ¨å…³é—­è¶…è¿‡ 30 å¤©æœªåˆå¹¶çš„ Dependabot PRï¼ˆé¿å…å †ç§¯ï¼‰
  - name: å…³é—­è¿‡æœŸçš„ Dependabot PR
    conditions:
      - author=dependabot[bot]
      - updated-at<30 days ago
      - -merged
      - -closed
    actions:
      close:
        message: |
          ğŸ¤– è‡ªåŠ¨å…³é—­æ­¤ PR

          æ­¤ PR å·²è¶…è¿‡ 30 å¤©æœªåˆå¹¶ã€‚Dependabot ä¼šåœ¨ä¸‹æ¬¡è¿è¡Œæ—¶åˆ›å»ºæ–°çš„æ›´æ–°ã€‚
          å¦‚æœéœ€è¦æ­¤æ›´æ–°ï¼Œè¯·æ‰‹åŠ¨æ›´æ–°ä¾èµ–æˆ–ç­‰å¾…ä¸‹æ¬¡è‡ªåŠ¨æ›´æ–°ã€‚

          This PR has been open for over 30 days. Dependabot will create a new update in the next run if needed.

  # è‡ªåŠ¨åˆå¹¶æœ‰ 'automerge' æ ‡ç­¾ä¸”æµ‹è¯•é€šè¿‡çš„ PR
  - name: è‡ªåŠ¨åˆå¹¶æ ‡è®°çš„ PR
    conditions:
      - label=automerge
      - check-success=CI
      - check-success=Commit Lint
      - "#approved-reviews-by>=1"
      - "#changes-requested-reviews-by=0"
    actions:
      queue:
        name: default

  # è‡ªåŠ¨ç»™å° PR æ·»åŠ æ ‡ç­¾ï¼ˆæ ¹æ®æ–‡ä»¶æ•°ï¼‰
  - name: æ ‡è®°å° PR æ–¹ä¾¿å¿«é€Ÿ Review
    conditions:
      - "#files<=3"
    actions:
      label:
        add:
          - quick-review

  # æé†’å¤§ PR éœ€è¦æ‹†åˆ†ï¼ˆæ ¹æ®æ–‡ä»¶æ•°ï¼‰
  - name: æé†’å¤§ PR
    conditions:
      - "#files>=20"
    actions:
      comment:
        message: |
          âš ï¸ è¿™ä¸ª PR æ”¹åŠ¨äº†è¾ƒå¤šæ–‡ä»¶ï¼ˆ20+ ä¸ªï¼‰ï¼Œå»ºè®®æ‹†åˆ†æˆå¤šä¸ªå° PRï¼Œä¾¿äº Review å’Œæµ‹è¯•ã€‚

          âš ï¸ This PR modifies many files (20+). Consider splitting it into smaller PRs for easier review and testing.

  # è‡ªåŠ¨æ›´æ–°è¿‡æœŸçš„åˆ†æ”¯
  - name: è‡ªåŠ¨æ›´æ–°è¿‡æœŸåˆ†æ”¯
    conditions:
      - -draft
      - -closed
      - base=master
      - "#approved-reviews-by>=1"
    actions:
      update: {}

  # è‡ªåŠ¨æ·»åŠ æ ‡ç­¾
  - name: æ·»åŠ  dependencies æ ‡ç­¾
    conditions:
      - author=dependabot[bot]
    actions:
      label:
        add:
          - dependencies

  # æ ‡è®°éœ€è¦å…³æ³¨çš„ PR
  - name: æ ‡è®°éœ€è¦æ›´æ–°çš„ PR
    conditions:
      - "#commits-behind>10"
    actions:
      label:
        add:
          - needs-rebase
