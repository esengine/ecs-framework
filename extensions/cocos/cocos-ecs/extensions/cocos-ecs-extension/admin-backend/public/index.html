<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocos ECS Extension - çƒ­æ›´æ–°ç®¡ç†åå°</title>
    <link href="https://cdn.jsdelivr.net/npm/element-plus@2.4.4/dist/index.css" rel="stylesheet">
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .header { background: #409eff; color: white; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .upload-area { 
            border: 2px dashed #dcdfe6; 
            border-radius: 8px; 
            padding: 40px; 
            text-align: center; 
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover { border-color: #409eff; background: #f0f8ff; }
        .version-list { max-height: 400px; overflow-y: auto; }
        .version-item { 
            padding: 16px; 
            border-bottom: 1px solid #ebeef5; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
        }
        .version-info h4 { margin: 0 0 8px 0; color: #303133; }
        .version-info p { margin: 0; color: #909399; font-size: 14px; }
        .status-tag { 
            padding: 4px 12px; 
            border-radius: 16px; 
            font-size: 12px; 
            font-weight: bold;
        }
        .status-active { background: #f0f9ff; color: #409eff; }
        .status-draft { background: #fdf6ec; color: #e6a23c; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { 
            padding: 24px; 
            text-align: center; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
        }
        .stat-number { font-size: 32px; font-weight: bold; margin-bottom: 8px; }
        .stat-label { font-size: 14px; opacity: 0.9; }
        .btn { 
            padding: 8px 16px; 
            border: none; 
            border-radius: 4px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s;
        }
        .btn-primary { background: #409eff; color: white; }
        .btn-primary:hover { background: #337ecc; }
        .btn-danger { background: #f56c6c; color: white; }
        .btn-danger:hover { background: #dd6161; }
        .btn-success { background: #67c23a; color: white; }
        .btn-success:hover { background: #5daf34; }
        .plugin-card:hover { border-color: #409eff; background: #f0f8ff; }
        .plugin-active { border-color: #409eff !important; background: #f0f8ff !important; }
        .filtered-out { opacity: 0.3; }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            width: 600px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e4e7ed;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: #303133;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #909399;
            padding: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f5f7fa;
            color: #606266;
        }

        .modal-body {
            padding: 24px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e4e7ed;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #606266;
            font-weight: 500;
        }

        .form-group small {
            display: block;
            margin-top: 4px;
            color: #909399;
            font-size: 12px;
        }

        .btn.btn-default {
            background: #fff;
            color: #606266;
            border: 1px solid #dcdfe6;
        }

        .btn.btn-default:hover {
            color: #409eff;
            border-color: #c6e2ff;
            background: #ecf5ff;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <h1 style="margin: 0; font-size: 24px;">ğŸš€ Cocos ECS Extension - çƒ­æ›´æ–°ç®¡ç†åå°</h1>
        </div>
        
        <div class="container">
            <!-- æ’ä»¶é€‰æ‹©å™¨ -->
            <div class="card">
                <div style="padding: 20px;">
                    <h2>ğŸ”Œ æ’ä»¶ç®¡ç†</h2>
                    <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                        <div 
                            v-for="plugin in plugins" 
                            :key="plugin.id"
                            @click="selectPlugin(plugin.id)"
                            :class="'plugin-card ' + (currentPlugin === plugin.id ? 'plugin-active' : '')"
                            style="flex: 1; min-width: 250px; padding: 20px; border: 2px solid #e4e7ed; border-radius: 8px; cursor: pointer; transition: all 0.3s;"
                        >
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span style="font-size: 32px;">{{ plugin.icon }}</span>
                                <div style="flex: 1;">
                                    <h3 style="margin: 0; color: #303133;">{{ plugin.displayName }}</h3>
                                    <p style="margin: 4px 0 0 0; color: #909399; font-size: 14px;">{{ plugin.description || 'æš‚æ— æè¿°' }}</p>
                                    <div style="margin: 8px 0 0 0; display: flex; gap: 16px; font-size: 12px;">
                                        <span style="color: #67c23a;">{{ plugin.status === 'active' ? 'âœ… æ´»è·ƒ' : 'â¸ï¸ æš‚åœ' }}</span>
                                        <span style="color: #409eff;">ğŸ“¦ ç‰ˆæœ¬: {{ plugin.versionCount || 0 }}</span>
                                        <span style="color: #e6a23c;">ğŸ“¥ ä¸‹è½½: {{ plugin.totalDownloads || 0 }}</span>
                                    </div>
                                    <p style="margin: 4px 0 0 0; color: #c0c4cc; font-size: 12px;">{{ plugin.author || 'æœªçŸ¥ä½œè€…' }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="card">
                <div style="padding: 20px;">
                    <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">{{ stats.totalVersions }}</div>
                            <div class="stat-label">æ€»ç‰ˆæœ¬æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ stats.activeUsers }}</div>
                            <div class="stat-label">æ´»è·ƒç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ stats.todayUpdates }}</div>
                            <div class="stat-label">ä»Šæ—¥æ›´æ–°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">{{ stats.successRate }}%</div>
                            <div class="stat-label">æˆåŠŸç‡</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸Šä¼ æ–°ç‰ˆæœ¬ -->
            <div class="card">
                <div style="padding: 20px;">
                    <h2>ğŸ“¦ ä¸Šä¼ æ–°ç‰ˆæœ¬</h2>
                    <div class="upload-area" @click="selectFile">
                        <div v-if="!uploading">
                            <i style="font-size: 48px; color: #c0c4cc;">ğŸ“</i>
                            <p style="margin: 16px 0 0 0; color: #606266;">ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ æ’ä»¶åŒ…</p>
                            <p style="margin: 8px 0 0 0; color: #909399; font-size: 14px;">æ”¯æŒ .zip æ ¼å¼ï¼Œæœ€å¤§ 100MB</p>
                        </div>
                        <div v-else>
                            <i style="font-size: 48px; color: #409eff;">â³</i>
                            <p style="margin: 16px 0 0 0; color: #409eff;">ä¸Šä¼ ä¸­... {{ uploadProgress }}%</p>
                        </div>
                    </div>
                    <input type="file" ref="fileInput" @change="handleFileSelect" accept=".zip" style="display: none;">
                    
                    <div v-if="selectedFile" style="margin-top: 20px; padding: 16px; background: #f5f7fa; border-radius: 4px;">
                        <h4 style="margin: 0 0 12px 0;">ç‰ˆæœ¬ä¿¡æ¯</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            <div>
                                <label>ç›®æ ‡æ’ä»¶:</label>
                                <select v-model="versionInfo.pluginId" style="width: 100%; padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;">
                                    <option v-for="plugin in plugins" :key="plugin.id" :value="plugin.id">
                                        {{ plugin.icon }} {{ plugin.displayName }}
                                    </option>
                                </select>
                            </div>
                            <div>
                                <label>ç‰ˆæœ¬å·:</label>
                                <input v-model="versionInfo.version" style="width: 100%; padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;">
                            </div>
                            <div>
                                <label>å‘å¸ƒæ¸ é“:</label>
                                <select v-model="versionInfo.channel" style="width: 100%; padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;">
                                    <option value="stable">ç¨³å®šç‰ˆ</option>
                                    <option value="beta">æµ‹è¯•ç‰ˆ</option>
                                    <option value="dev">å¼€å‘ç‰ˆ</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top: 16px;">
                            <label>æ›´æ–°è¯´æ˜:</label>
                            <textarea v-model="versionInfo.description" rows="3" style="width: 100%; padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;"></textarea>
                        </div>
                        <div style="margin-top: 16px;">
                            <label>
                                <input type="checkbox" v-model="versionInfo.mandatory"> å¼ºåˆ¶æ›´æ–°
                            </label>
                        </div>
                        <div style="margin-top: 16px;">
                            <button class="btn btn-primary" @click="uploadVersion" :disabled="uploading">
                                {{ uploading ? 'ä¸Šä¼ ä¸­...' : 'å‘å¸ƒç‰ˆæœ¬' }}
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç‰ˆæœ¬ç®¡ç† -->
            <div class="card">
                <div style="padding: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>ğŸ“‹ ç‰ˆæœ¬ç®¡ç† - {{ getCurrentPluginName() }}</h2>
                        <div style="display: flex; gap: 12px; align-items: center;">
                            <button class="btn btn-primary" @click="showCreatePlugin = true">+ åˆ›å»ºæ–°é¡¹ç›®</button>
                            <select v-model="currentPlugin" @change="filterVersions" style="padding: 8px; border: 1px solid #dcdfe6; border-radius: 4px;">
                                <option value="">å…¨éƒ¨æ’ä»¶</option>
                                <option v-for="plugin in plugins" :key="plugin.id" :value="plugin.id">
                                    {{ plugin.icon }} {{ plugin.displayName }}
                                </option>
                            </select>
                            <button class="btn btn-success" @click="refreshVersions">åˆ·æ–°åˆ—è¡¨</button>
                        </div>
                    </div>
                    
                                         <div class="version-list">
                         <div v-for="version in filteredVersions" :key="version.id" class="version-item">
                             <div class="version-info">
                                 <h4>
                                     <span style="margin-right: 8px;">{{ getPluginIcon(version.pluginId) }}</span>
                                     {{ version.version }} ({{ getChannelName(version.channel) }})
                                     <span style="font-size: 12px; color: #909399; margin-left: 8px;">- {{ getPluginDisplayName(version.pluginId) }}</span>
                                 </h4>
                                 <p>{{ version.description }}</p>
                                 <p>å‘å¸ƒæ—¶é—´: {{ formatDate(version.release_date) }} | æ–‡ä»¶å¤§å°: {{ formatSize(version.file_size) }}</p>
                             </div>
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <span :class="'status-tag status-' + version.status">
                                    {{ getStatusName(version.status) }}
                                </span>
                                <button class="btn btn-primary" @click="editVersion(version)">ç¼–è¾‘</button>
                                <button class="btn btn-danger" @click="deleteVersion(version)">åˆ é™¤</button>
                            </div>
                        </div>
                                                 <div v-if="filteredVersions.length === 0" style="text-align: center; padding: 40px; color: #909399;">
                             {{ currentPlugin ? 'è¯¥æ’ä»¶æš‚æ— ç‰ˆæœ¬æ•°æ®' : 'æš‚æ— ç‰ˆæœ¬æ•°æ®' }}
                         </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ›å»ºé¡¹ç›®æ¨¡æ€æ¡† -->
        <div v-if="showCreatePlugin" class="modal-overlay" @click="showCreatePlugin = false">
            <div class="modal-content" @click.stop>
                <div class="modal-header">
                    <h3>ğŸ¯ åˆ›å»ºæ–°é¡¹ç›®</h3>
                    <button @click="showCreatePlugin = false" class="modal-close">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>é¡¹ç›®ID *</label>
                        <input v-model="newPlugin.id" placeholder="ä¾‹å¦‚: my-awesome-plugin" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                        <small>é¡¹ç›®IDå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå»ºè®®ä½¿ç”¨å°å†™å­—æ¯å’ŒçŸ­æ¨ªçº¿</small>
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®åç§° *</label>
                        <input v-model="newPlugin.name" placeholder="ä¾‹å¦‚: my-awesome-plugin" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>æ˜¾ç¤ºåç§° *</label>
                        <input v-model="newPlugin.displayName" placeholder="ä¾‹å¦‚: My Awesome Plugin" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®æè¿°</label>
                        <textarea v-model="newPlugin.description" rows="3" placeholder="æè¿°ä½ çš„é¡¹ç›®åŠŸèƒ½å’Œç‰¹ç‚¹..." style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>ä½œè€…</label>
                        <input v-model="newPlugin.author" placeholder="ä¾‹å¦‚: Your Name" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>ä»“åº“åœ°å€</label>
                        <input v-model="newPlugin.repository" placeholder="ä¾‹å¦‚: https://github.com/user/repo" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                    </div>
                    <div class="form-group">
                        <label>å›¾æ ‡ (Emoji)</label>
                        <input v-model="newPlugin.icon" placeholder="ğŸ“¦" maxlength="2" style="width: 100%; padding: 12px; border: 1px solid #dcdfe6; border-radius: 4px;">
                    </div>
                </div>
                <div class="modal-footer">
                    <button @click="showCreatePlugin = false" class="btn btn-default">å–æ¶ˆ</button>
                    <button @click="createPlugin" class="btn btn-primary" :disabled="creatingPlugin">
                        {{ creatingPlugin ? 'åˆ›å»ºä¸­...' : 'åˆ›å»ºé¡¹ç›®' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.8/dist/vue.global.js"></script>
    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    uploading: false,
                    uploadProgress: 0,
                    selectedFile: null,
                    currentPlugin: 'cocos-ecs-extension', // å½“å‰é€‰ä¸­çš„æ’ä»¶
                    showCreatePlugin: false,
                    creatingPlugin: false,
                    newPlugin: {
                        id: '',
                        name: '',
                        displayName: '',
                        description: '',
                        author: '',
                        repository: '',
                        icon: 'ğŸ“¦'
                    },
                    plugins: [],
                    versionInfo: {
                        pluginId: 'cocos-ecs-extension',
                        version: '',
                        channel: 'stable',
                        description: '',
                        mandatory: false
                    },
                    stats: {
                        totalVersions: 0,
                        activeUsers: 0,
                        todayUpdates: 0,
                        successRate: 100.0
                    },
                    versions: []
                }
            },
            computed: {
                filteredVersions() {
                    if (!this.currentPlugin) {
                        return this.versions;
                    }
                    return this.versions.filter(v => v.pluginId === this.currentPlugin);
                }
            },
            methods: {
                selectPlugin(pluginId) {
                    this.currentPlugin = pluginId;
                    this.versionInfo.pluginId = pluginId;
                },
                filterVersions() {
                    // è§¦å‘è®¡ç®—å±æ€§é‡æ–°è®¡ç®—
                },
                getCurrentPluginName() {
                    if (!this.currentPlugin) return 'å…¨éƒ¨æ’ä»¶';
                    const plugin = this.plugins.find(p => p.id === this.currentPlugin);
                    return plugin ? plugin.displayName : 'æœªçŸ¥æ’ä»¶';
                },
                getPluginIcon(pluginId) {
                    const plugin = this.plugins.find(p => p.id === pluginId);
                    return plugin ? plugin.icon : 'ğŸ“¦';
                },
                getPluginDisplayName(pluginId) {
                    const plugin = this.plugins.find(p => p.id === pluginId);
                    return plugin ? plugin.displayName : pluginId;
                },
                selectFile() {
                    this.$refs.fileInput.click();
                },
                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        this.selectedFile = file;
                        // è‡ªåŠ¨æå–ç‰ˆæœ¬å·ï¼ˆå¦‚æœæ–‡ä»¶ååŒ…å«ç‰ˆæœ¬ä¿¡æ¯ï¼‰
                        const match = file.name.match(/(\d+\.\d+\.\d+)/);
                        if (match) {
                            this.versionInfo.version = match[1];
                        }
                    }
                },
                async uploadVersion() {
                    if (!this.selectedFile) return;
                    
                    this.uploading = true;
                    this.uploadProgress = 0;
                    
                    try {
                        const formData = new FormData();
                        formData.append('package', this.selectedFile);
                        formData.append('pluginId', this.versionInfo.pluginId);
                        formData.append('version', this.versionInfo.version);
                        formData.append('channel', this.versionInfo.channel);
                        formData.append('description', this.versionInfo.description);
                        formData.append('mandatory', this.versionInfo.mandatory.toString());
                        
                        // æ¨¡æ‹Ÿä¸Šä¼ è¿›åº¦
                        const progressInterval = setInterval(() => {
                            this.uploadProgress = Math.min(this.uploadProgress + Math.random() * 15, 90);
                        }, 200);
                        
                        // è°ƒç”¨çœŸå®çš„ä¸Šä¼ API
                        const response = await fetch('/api/upload/package', {
                            method: 'POST',
                            body: formData
                        });
                        
                        clearInterval(progressInterval);
                        this.uploadProgress = 100;
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            alert(`ç‰ˆæœ¬ä¸Šä¼ æˆåŠŸï¼\næ’ä»¶: ${result.data.pluginId}\nç‰ˆæœ¬: ${result.data.version}\næ–‡ä»¶æ•°: ${result.data.filesCount}`);
                            
                            // é‡ç½®è¡¨å•
                            this.selectedFile = null;
                            this.versionInfo = {
                                pluginId: this.currentPlugin,
                                version: '',
                                channel: 'stable',
                                description: '',
                                mandatory: false
                            };
                            this.$refs.fileInput.value = '';
                            
                            // åˆ·æ–°æ•°æ®
                            await this.refreshVersions();
                            await this.refreshStats();
                        } else {
                            alert('ä¸Šä¼ å¤±è´¥: ' + result.error);
                        }
                        
                    } catch (error) {
                        alert('ä¸Šä¼ å¤±è´¥: ' + error.message);
                    } finally {
                        this.uploading = false;
                    }
                },
                async refreshVersions() {
                    try {
                        const params = new URLSearchParams();
                        if (this.currentPlugin) {
                            params.set('pluginId', this.currentPlugin);
                        }
                        
                        const response = await fetch(`/api/versions?${params}`);
                        const result = await response.json();
                        
                        if (result.success) {
                            this.versions = result.data.map(v => ({
                                id: v.id,
                                pluginId: v.pluginId,
                                version: v.version,
                                channel: v.channel,
                                description: v.description,
                                release_date: v.releaseDate,
                                file_size: v.fileSize,
                                status: v.status
                            }));
                        } else {
                            console.error('è·å–ç‰ˆæœ¬åˆ—è¡¨å¤±è´¥:', result.error);
                        }
                    } catch (error) {
                        console.error('åˆ·æ–°ç‰ˆæœ¬åˆ—è¡¨å¤±è´¥:', error);
                    }
                },
                async refreshStats() {
                    try {
                        const response = await fetch('/api/stats');
                        const result = await response.json();
                        
                        if (result.success) {
                            this.stats = result.data;
                        } else {
                            console.error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥:', result.error);
                        }
                    } catch (error) {
                        console.error('åˆ·æ–°ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
                    }
                },
                editVersion(version) {
                    // ç¼–è¾‘ç‰ˆæœ¬
                    console.log('ç¼–è¾‘ç‰ˆæœ¬:', version);
                },
                deleteVersion(version) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤ç‰ˆæœ¬ ' + version.version + ' å—ï¼Ÿ')) {
                        // åˆ é™¤ç‰ˆæœ¬
                        console.log('åˆ é™¤ç‰ˆæœ¬:', version);
                    }
                },
                getChannelName(channel) {
                    const names = { stable: 'ç¨³å®šç‰ˆ', beta: 'æµ‹è¯•ç‰ˆ', dev: 'å¼€å‘ç‰ˆ' };
                    return names[channel] || channel;
                },
                getStatusName(status) {
                    const names = { active: 'å·²å‘å¸ƒ', draft: 'è‰ç¨¿' };
                    return names[status] || status;
                },
                formatDate(dateString) {
                    return new Date(dateString).toLocaleString('zh-CN');
                },
                formatSize(bytes) {
                    const units = ['B', 'KB', 'MB', 'GB'];
                    let size = bytes;
                    let unitIndex = 0;
                    while (size >= 1024 && unitIndex < units.length - 1) {
                        size /= 1024;
                        unitIndex++;
                    }
                    return size.toFixed(1) + ' ' + units[unitIndex];
                }
            },
            async mounted() {
                // åŠ è½½æ’ä»¶åˆ—è¡¨
                await this.loadPlugins();
                
                // åŠ è½½åˆå§‹æ•°æ®
                await this.refreshStats();
                await this.refreshVersions();
            },
            async loadPlugins() {
                try {
                    const response = await fetch('/api/plugins');
                    const result = await response.json();
                    
                    if (result.success) {
                        this.plugins = result.data.map(p => ({
                            id: p.id,
                            name: p.name,
                            displayName: p.displayName,
                            description: p.description,
                            author: p.author,
                            repository: p.repository,
                            icon: p.icon,
                            status: p.status,
                            versionCount: p.versionCount || 0,
                            totalDownloads: p.totalDownloads || 0
                        }));
                        
                        // å¦‚æœæ²¡æœ‰é€‰ä¸­æ’ä»¶ä¸”æœ‰æ’ä»¶æ•°æ®ï¼Œè‡ªåŠ¨é€‰ä¸­ç¬¬ä¸€ä¸ª
                        if (!this.currentPlugin && this.plugins.length > 0) {
                            this.currentPlugin = this.plugins[0].id;
                            this.versionInfo.pluginId = this.plugins[0].id;
                        }
                    } else {
                        console.error('è·å–æ’ä»¶åˆ—è¡¨å¤±è´¥:', result.error);
                    }
                } catch (error) {
                    console.error('åŠ è½½æ’ä»¶åˆ—è¡¨å¤±è´¥:', error);
                }
            },
            async createPlugin() {
                if (!this.newPlugin.id || !this.newPlugin.name || !this.newPlugin.displayName) {
                    alert('è¯·å¡«å†™å¿…è¦çš„å­—æ®µï¼šé¡¹ç›®IDã€é¡¹ç›®åç§°ã€æ˜¾ç¤ºåç§°');
                    return;
                }

                this.creatingPlugin = true;

                try {
                    const response = await fetch('/api/plugins', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.newPlugin)
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(`é¡¹ç›®åˆ›å»ºæˆåŠŸï¼\né¡¹ç›®åç§°: ${result.data.displayName}\né¡¹ç›®ID: ${result.data.id}`);

                        // é‡ç½®è¡¨å•
                        this.newPlugin = {
                            id: '',
                            name: '',
                            displayName: '',
                            description: '',
                            author: '',
                            repository: '',
                            icon: 'ğŸ“¦'
                        };

                        // å…³é—­æ¨¡æ€æ¡†
                        this.showCreatePlugin = false;

                        // åˆ·æ–°æ’ä»¶åˆ—è¡¨
                        await this.loadPlugins();
                        await this.refreshStats();
                    } else {
                        alert('åˆ›å»ºå¤±è´¥: ' + result.error);
                    }

                } catch (error) {
                    alert('åˆ›å»ºå¤±è´¥: ' + error.message);
                } finally {
                    this.creatingPlugin = false;
                }
            }
        }).mount('#app');
    </script>
</body>
</html> 