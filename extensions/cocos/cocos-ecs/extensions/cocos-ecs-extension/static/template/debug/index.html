<div class="debug-panel">
    <!-- é¡¶éƒ¨æ§åˆ¶æ  -->
    <div class="debug-toolbar">
        <div class="toolbar-section">
            <label>æ¸¸æˆå®ä¾‹:</label>
            <select v-model="selectedInstanceId" @change="onInstanceChanged" class="instance-selector">
                <option value="">-- é€‰æ‹©å®ä¾‹ --</option>
                <option v-for="instance in gameInstances" :key="instance.id" :value="instance.id">
                    {{ instance.name }} ({{ instance.isActive ? 'æ´»è·ƒ' : 'ç¦»çº¿' }})
                </option>
            </select>
            <span class="instance-count">{{ gameInstances.length }} ä¸ªå®ä¾‹</span>
        </div>
        
        <div class="toolbar-section">
            <button @click="manualRefresh" class="btn-refresh" :disabled="!selectedInstanceId">
                <ui-icon value="refresh"></ui-icon>
                åˆ·æ–°
            </button>
            <label class="checkbox-label">
                <input type="checkbox" v-model="isAutoRefresh" @change="toggleAutoRefresh">
                è‡ªåŠ¨åˆ·æ–°
            </label>
            <select v-model="refreshInterval" @change="changeRefreshInterval" :disabled="!isAutoRefresh">
                <option :value="100">0.1ç§’</option>
                <option :value="250">0.25ç§’</option>
                <option :value="500">0.5ç§’</option>
                <option :value="1000">1ç§’</option>
                <option :value="2000">2ç§’</option>
            </select>
        </div>
        
        <div class="toolbar-section">
            <span class="last-update">{{ lastUpdateTime }}</span>
        </div>
    </div>

    <!-- è¿æ¥çŠ¶æ€å’ŒåŸºç¡€ä¿¡æ¯ -->
    <div class="debug-section">
        <div class="section-header">
            <h2>ğŸ“Š å®ä¾‹çŠ¶æ€</h2>
        </div>
        <div class="status-grid" v-if="selectedInstanceId && debugInfo.instanceId">
            <div class="status-item">
                <span class="label">å®ä¾‹åç§°:</span>
                <span class="value">{{ debugInfo.instanceName }}</span>
            </div>
            <div class="status-item">
                <span class="label">è¿è¡ŒçŠ¶æ€:</span>
                <span class="value" :class="{ online: debugInfo.isRunning, offline: !debugInfo.isRunning }">
                    {{ debugInfo.isRunning ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢' }}
                </span>
            </div>
            <div class="status-item">
                <span class="label">å½“å‰åœºæ™¯:</span>
                <span class="value">{{ debugInfo.currentScene }}</span>
            </div>
            <div class="status-item">
                <span class="label">è¿è¡Œæ—¶é—´:</span>
                <span class="value">{{ formatUptime(debugInfo.uptime) }}</span>
            </div>
        </div>
        
        <div class="no-instance" v-else>
            <ui-icon value="info" class="info-icon"></ui-icon>
            <span>è¯·é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå®ä¾‹æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span>
        </div>
    </div>

    <!-- æ€§èƒ½ç›‘æ§ -->
    <div class="debug-section" v-if="debugInfo.instanceId">
        <div class="section-header">
            <h2>âš¡ æ€§èƒ½ç›‘æ§</h2>
        </div>
        <div class="performance-grid">
            <div class="perf-card">
                <div class="perf-title">å¸§ç‡</div>
                <div class="perf-value" :class="getFpsColor(debugInfo.performance.fps)">
                    {{ debugInfo.performance.fps }} FPS
                </div>
                <div class="perf-detail">
                    å¼•æ“å¸§æ—¶é—´: {{ debugInfo.performance.engineFrameTime?.toFixed(2) || '0.00' }}ms
                </div>
            </div>
            <div class="perf-card">
                <div class="perf-title">ECSæ‰§è¡Œæ—¶é—´</div>
                <div class="perf-value" :class="getECSTimeColor(debugInfo.performance.ecsPercentage)">
                    {{ debugInfo.performance.frameTime.toFixed(3) }}ms
                </div>
                <div class="perf-detail">
                    å æ€»å¸§æ—¶é—´: {{ debugInfo.performance.ecsPercentage?.toFixed(1) || '0.0' }}%
                </div>
            </div>
            <div class="perf-card">
                <div class="perf-title">æ€»å†…å­˜</div>
                <div class="perf-value" :class="getMemoryColor(debugInfo.memory.usedMemory / debugInfo.memory.totalMemory * 100)">
                    {{ formatMemory(debugInfo.memory.usedMemory) }}
                </div>
                <div class="perf-detail">
                    / {{ formatMemory(debugInfo.memory.totalMemory) }}
                </div>
            </div>
            <div class="perf-card">
                <div class="perf-title">GCå›æ”¶</div>
                <div class="perf-value">{{ debugInfo.memory.gcCollections }}</div>
                <div class="perf-detail">æ¬¡æ•°</div>
            </div>
        </div>
    </div>

    <!-- å†…å­˜åˆ†æ -->
    <div class="debug-section" v-if="debugInfo.instanceId">
        <div class="section-header">
            <h2>ğŸ’¾ å†…å­˜åˆ†æ</h2>
        </div>
        <div class="memory-breakdown">
            <div class="memory-item">
                <span class="memory-label">å®ä½“å†…å­˜:</span>
                <span class="memory-value">{{ formatMemory(debugInfo.memory.entityMemory) }}</span>
                <div class="memory-bar">
                    <div class="memory-fill" :style="{ width: (debugInfo.memory.entityMemory / debugInfo.memory.usedMemory * 100) + '%' }"></div>
                </div>
            </div>
            <div class="memory-item">
                <span class="memory-label">ç»„ä»¶å†…å­˜:</span>
                <span class="memory-value">{{ formatMemory(debugInfo.memory.componentMemory) }}</span>
                <div class="memory-bar">
                    <div class="memory-fill" :style="{ width: (debugInfo.memory.componentMemory / debugInfo.memory.usedMemory * 100) + '%' }"></div>
                </div>
            </div>
            <div class="memory-item">
                <span class="memory-label">ç³»ç»Ÿå†…å­˜:</span>
                <span class="memory-value">{{ formatMemory(debugInfo.memory.systemMemory) }}</span>
                <div class="memory-bar">
                    <div class="memory-fill" :style="{ width: (debugInfo.memory.systemMemory / debugInfo.memory.usedMemory * 100) + '%' }"></div>
                </div>
            </div>
            <div class="memory-item">
                <span class="memory-label">å¯¹è±¡æ± å†…å­˜:</span>
                <span class="memory-value">{{ formatMemory(debugInfo.memory.pooledMemory) }}</span>
                <div class="memory-bar">
                    <div class="memory-fill" :style="{ width: (debugInfo.memory.pooledMemory / debugInfo.memory.usedMemory * 100) + '%' }"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- å®ä½“ç»Ÿè®¡ -->
    <div class="debug-section" v-if="debugInfo.instanceId">
        <div class="section-header">
            <h2>ğŸ‘¥ å®ä½“ç»Ÿè®¡</h2>
        </div>
        <div class="entity-stats">
            <div class="stat-card">
                <div class="stat-number">{{ debugInfo.entities.total }}</div>
                <div class="stat-label">æ€»å®ä½“æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ debugInfo.entities.active }}</div>
                <div class="stat-label">æ´»è·ƒå®ä½“</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ debugInfo.entities.inactive }}</div>
                <div class="stat-label">éæ´»è·ƒå®ä½“</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ debugInfo.entities.pendingAdd }}</div>
                <div class="stat-label">å¾…æ·»åŠ </div>
            </div>
        </div>
        
        <!-- Archetypeåˆ†å¸ƒ -->
        <div class="archetype-section" v-if="debugInfo.entities.entitiesPerArchetype.length > 0">
            <h3>Archetype åˆ†å¸ƒ</h3>
            <div class="archetype-list">
                <div v-for="archetype in debugInfo.entities.entitiesPerArchetype" :key="archetype.signature" class="archetype-item">
                    <div class="archetype-signature">{{ archetype.signature }}</div>
                    <div class="archetype-stats">
                        <span class="entity-count">{{ archetype.count }} å®ä½“</span>
                        <span class="memory-usage">{{ formatMemory(archetype.memory) }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»„ä»¶åˆ†æ -->
    <div class="debug-section" v-if="debugInfo.instanceId">
        <div class="section-header">
            <h2>ğŸ§© ç»„ä»¶åˆ†æ</h2>
            <div class="section-help">
                <button class="help-btn" @click="showComponentPoolHelp = !showComponentPoolHelp" title="ç»„ä»¶å¯¹è±¡æ± ä½¿ç”¨è¯´æ˜">
                    <ui-icon value="help"></ui-icon>
                    å¯¹è±¡æ± ä½¿ç”¨è¯´æ˜
                </button>
            </div>
        </div>
        
        <!-- å¯¹è±¡æ± ä½¿ç”¨è¯´æ˜ -->
        <div v-if="showComponentPoolHelp" class="help-panel">
            <div class="help-content">
                <h4>ğŸ“– ç»„ä»¶å¯¹è±¡æ± ä½¿ç”¨æŒ‡å—</h4>
                <p>ç»„ä»¶å¯¹è±¡æ± ç”¨äºå¤ç”¨ç»„ä»¶å®ä¾‹ï¼Œå‡å°‘é¢‘ç¹åˆ›å»º/é”€æ¯ç»„ä»¶å¸¦æ¥çš„å†…å­˜åˆ†é…å¼€é”€ã€‚å½“å‰åˆ©ç”¨ç‡ä¸º0è¡¨ç¤ºè¿˜æœªé…ç½®å¯¹è±¡æ± ã€‚</p>
                
                <div class="help-steps">
                    <div class="help-step">
                        <h5>1. æ³¨å†Œç»„ä»¶å¯¹è±¡æ± </h5>
                        <pre class="code-example">import { ComponentPoolManager } from '@esengine/ecs-framework';

// ä¸ºTransformç»„ä»¶æ³¨å†Œå¯¹è±¡æ± 
ComponentPoolManager.getInstance().registerPool(
    'Transform',
    () => new Transform(),
    (comp) => comp.reset(), // å¯é€‰çš„é‡ç½®å‡½æ•°
    100 // æ± å¤§å°
);</pre>
                    </div>
                    
                    <div class="help-step">
                        <h5>2. ä½¿ç”¨å¯¹è±¡æ± è·å–ç»„ä»¶</h5>
                        <pre class="code-example">// ä»å¯¹è±¡æ± è·å–ç»„ä»¶å®ä¾‹
const poolManager = ComponentPoolManager.getInstance();
const transform = poolManager.acquireComponent('Transform');

// ä½¿ç”¨å®Œæ¯•åé‡Šæ”¾å›æ± ä¸­
poolManager.releaseComponent('Transform', transform);</pre>
                    </div>
                    
                    <div class="help-step">
                        <h5>3. æŸ¥çœ‹æ€§èƒ½æ”¹è¿›</h5>
                        <p>æ­£ç¡®é…ç½®åï¼Œåˆ©ç”¨ç‡æ å°†æ˜¾ç¤ºæ± çš„ä½¿ç”¨æƒ…å†µã€‚åˆ©ç”¨ç‡è¶Šé«˜è¯´æ˜å¯¹è±¡æ± è¢«æœ‰æ•ˆä½¿ç”¨ï¼Œå¯ä»¥å‡å°‘GCå‹åŠ›ã€‚</p>
                    </div>
                </div>
                
                <div class="help-links">
                    <a href="#" @click="openDocumentation('component-pool')" class="doc-link">
                        <ui-icon value="book"></ui-icon>
                        æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£
                    </a>
                    <a href="#" @click="openDocumentation('performance-optimization')" class="doc-link">
                        <ui-icon value="speed"></ui-icon>
                        æ€§èƒ½ä¼˜åŒ–æŒ‡å—
                    </a>
                </div>
                
                <div class="doc-access-note">
                    <ui-icon value="info"></ui-icon>
                    <span>å¦‚æœæ— æ³•ç›´æ¥æ‰“å¼€æ–‡æ¡£é“¾æ¥ï¼Œé“¾æ¥å°†è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­ç²˜è´´è®¿é—®</span>
                </div>
            </div>
        </div>
        
        <div class="component-overview">
            <div class="overview-item">
                <span class="label">ç»„ä»¶ç±»å‹:</span>
                <span class="value">{{ debugInfo.components.totalTypes }}</span>
            </div>
            <div class="overview-item">
                <span class="label">ç»„ä»¶å®ä¾‹:</span>
                <span class="value">{{ debugInfo.components.totalInstances }}</span>
            </div>
        </div>
        
        <div class="component-table" v-if="debugInfo.components.componentStats.length > 0">
            <div class="table-header">
                <div class="col-name">ç»„ä»¶ç±»å‹</div>
                <div class="col-count">å®ä¾‹æ•°</div>
                <div class="col-memory">å†…å­˜å ç”¨</div>
                <div class="col-pool">å¯¹è±¡æ± </div>
                <div class="col-efficiency">
                    åˆ©ç”¨ç‡
                    <span class="help-tooltip" title="å¯¹è±¡æ± åˆ©ç”¨ç‡ï¼šä½¿ç”¨ä¸­çš„å®ä¾‹ / æ± æ€»å¤§å°ã€‚åˆ©ç”¨ç‡ä¸º0è¡¨ç¤ºæœªé…ç½®å¯¹è±¡æ± ">
                        <ui-icon value="help"></ui-icon>
                    </span>
                </div>
            </div>
            <div v-for="comp in debugInfo.components.componentStats" :key="comp.typeName" class="table-row">
                <div class="col-name">{{ comp.typeName }}</div>
                <div class="col-count">{{ comp.instanceCount }}</div>
                <div class="col-memory">{{ formatMemory(comp.totalMemory) }}</div>
                <div class="col-pool">
                    {{ comp.poolSize || 'æœªé…ç½®' }}
                    <span v-if="comp.poolSize === 0" class="not-configured" title="ç‚¹å‡»ä¸Šæ–¹è¯´æ˜äº†è§£å¦‚ä½•é…ç½®å¯¹è±¡æ± ">
                        <ui-icon value="warning"></ui-icon>
                    </span>
                </div>
                <div class="col-efficiency">
                    <div class="efficiency-bar">
                        <div class="efficiency-fill" :style="{ width: comp.poolUtilization + '%' }"></div>
                    </div>
                    {{ comp.poolUtilization.toFixed(1) }}%
                    <span v-if="comp.poolUtilization === 0 && comp.poolSize === 0" class="no-pool-hint">
                        (æ— å¯¹è±¡æ± )
                    </span>
                </div>
            </div>
        </div>
        
        <!-- æ— å¯¹è±¡æ± ç»„ä»¶æç¤º -->
        <div v-if="debugInfo.components.componentStats.length > 0 && debugInfo.components.componentStats.every(c => c.poolSize === 0)" class="pool-suggestion">
            <div class="suggestion-content">
                <ui-icon value="lightbulb" class="suggestion-icon"></ui-icon>
                <div class="suggestion-text">
                    <h4>ğŸ’¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®</h4>
                    <p>æ£€æµ‹åˆ°æ‰€æœ‰ç»„ä»¶éƒ½æœªé…ç½®å¯¹è±¡æ± ã€‚ä¸ºé¢‘ç¹åˆ›å»º/é”€æ¯çš„ç»„ä»¶é…ç½®å¯¹è±¡æ± å¯ä»¥æ˜¾è‘—æå‡æ€§èƒ½ï¼Œå‡å°‘åƒåœ¾å›æ”¶å‹åŠ›ã€‚</p>
                    <button @click="showComponentPoolHelp = true" class="suggestion-action">
                        äº†è§£å¦‚ä½•é…ç½®å¯¹è±¡æ± 
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç³»ç»Ÿæ€§èƒ½ -->
    <div class="debug-section" v-if="debugInfo.instanceId">
        <div class="section-header">
            <h2>âš™ï¸ ç³»ç»Ÿæ€§èƒ½</h2>
        </div>
        <div class="systems-table" v-if="debugInfo.systems.systemStats.length > 0">
            <div class="table-header">
                <div class="col-name">ç³»ç»Ÿåç§°</div>
                <div class="col-entities">å®ä½“æ•°</div>
                <div class="col-time">æ‰§è¡Œæ—¶é—´</div>
                <div class="col-percentage">ECSå æ¯”</div>
                <div class="col-order">ä¼˜å…ˆçº§</div>
                <div class="col-status">çŠ¶æ€</div>
            </div>
            <div v-for="system in debugInfo.systems.systemStats" :key="system.name" class="table-row">
                <div class="col-name">{{ system.name }}</div>
                <div class="col-entities">{{ system.entityCount }}</div>
                <div class="col-time">
                    <span :class="getExecutionTimeColor(system.averageExecutionTime)">
                        {{ system.averageExecutionTime.toFixed(3) }}ms
                    </span>
                    <div class="time-range">
                        ({{ system.minExecutionTime.toFixed(3) }}-{{ system.maxExecutionTime.toFixed(3) }}ms)
                    </div>
                </div>
                <div class="col-percentage">
                    <div class="percentage-bar">
                        <div class="percentage-fill" :style="{ width: (system.percentage || 0) + '%' }"></div>
                    </div>
                    {{ (system.percentage || 0).toFixed(1) }}%
                </div>
                <div class="col-order">{{ system.updateOrder }}</div>
                <div class="col-status">
                    <span :class="{ enabled: system.enabled, disabled: !system.enabled }">
                        {{ system.enabled ? 'å¯ç”¨' : 'ç¦ç”¨' }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- æœåŠ¡å™¨çŠ¶æ€ -->
    <div class="debug-section" v-if="gameInstances.length === 0">
        <div class="section-header">
            <h2>ğŸ”Œ è°ƒè¯•æœåŠ¡å™¨</h2>
        </div>
        <div class="server-status">
            <div class="status-message">
                <ui-icon value="wifi" class="server-icon"></ui-icon>
                <div class="message-content">
                    <h3>ç­‰å¾…æ¸¸æˆå®ä¾‹è¿æ¥...</h3>
                    <p>è°ƒè¯•æœåŠ¡å™¨æ­£åœ¨ <strong>ws://localhost:8080</strong> ç›‘å¬è¿æ¥</p>
                    <p>è¯·ç¡®ä¿æ¸¸æˆä¸­çš„ECSæ¡†æ¶å·²å¯ç”¨è°ƒè¯•æ¨¡å¼</p>
                </div>
            </div>
            
            <div class="connection-help">
                <h4>è¿æ¥è¯´æ˜:</h4>
                <ul>
                    <li>åœ¨ECSManagerç»„ä»¶ä¸­å¯ç”¨è°ƒè¯•æ¨¡å¼</li>
                    <li>è¿è¡Œæ¸¸æˆï¼Œæ¡†æ¶ä¼šè‡ªåŠ¨è¿æ¥åˆ°è°ƒè¯•æœåŠ¡å™¨</li>
                    <li>æ”¯æŒå¤šä¸ªæ¸¸æˆå®ä¾‹åŒæ—¶è¿æ¥</li>
                    <li>å¯ä»¥åœ¨ä¸Šæ–¹é€‰æ‹©ä¸åŒçš„å®ä¾‹è¿›è¡Œè°ƒè¯•</li>
                </ul>
            </div>
        </div>
    </div>
</div> 
</div> 